# HMI 개발 및 배포 워크플로우 가이드

## 📂 폴더 구조 이해

### HMI_REAL (개발 환경)
```
HMI_REAL/                          총 용량: 124MB
├── frontend/
│   ├── src/                       ← 여기서 코드 수정!
│   ├── node_modules/              (87MB - 개발 도구)
│   ├── dist/                      (빌드 결과물)
│   └── package.json
├── backend/
│   ├── main.py                    ← 여기서 코드 수정!
│   ├── modbus_client.py           ← 여기서 코드 수정!
│   ├── venv/                      (37MB - Python 환경)
│   └── requirements.txt
├── simulator/
│   └── plc_simulator.py           ← 여기서 코드 수정!
├── 배포_패키지_생성.bat           ⭐ 배포 자동화 스크립트
└── START_HMI.bat                  (개발 모드 실행)
```

### HMI_DEPLOY (배포 패키지)
```
HMI_DEPLOY/                        총 용량: 38MB
├── frontend/
│   └── dist/                      (빌드된 파일만)
├── backend/
│   ├── *.py                       (소스 코드)
│   └── venv/                      (실행 환경)
├── simulator/
│   └── plc_simulator.py
└── START_HMI_DEPLOY.bat           (배포 모드 실행)
```

---

## 🔄 개발 워크플로우

### 1️⃣ 코드 수정 (HMI_REAL에서)

#### Frontend 수정
```bash
cd C:\Users\my\Desktop\HMI_REAL\frontend\src

# 파일 수정
# - components/*.jsx
# - App.jsx
# - *.css
```

#### Backend 수정
```bash
cd C:\Users\my\Desktop\HMI_REAL\backend

# 파일 수정
# - main.py
# - modbus_client.py
```

#### Simulator 수정
```bash
cd C:\Users\my\Desktop\HMI_REAL\simulator

# 파일 수정
# - plc_simulator.py
```

---

### 2️⃣ 개발 환경에서 테스트

```bash
# HMI_REAL 폴더에서
START_HMI.bat 실행
```

**특징**:
- Frontend를 개발 모드(Vite dev server)로 실행
- 코드 수정 시 자동 새로고침 (Hot Reload)
- 빠른 반복 개발 가능

**접속**:
- Frontend: http://localhost:5173 (개발 서버)
- Backend: http://localhost:8000
- PLC Simulator: 192.168.0.130:502

---

### 3️⃣ 배포 패키지 생성 (자동화!)

```bash
# HMI_REAL 폴더에서
배포_패키지_생성.bat 실행
```

**자동으로 수행되는 작업**:
1. ✅ Frontend 빌드 (`npm run build`)
2. ✅ 배포 폴더 초기화
3. ✅ Frontend dist 복사
4. ✅ Backend 파일 복사
5. ✅ Simulator 복사
6. ✅ 실행 파일 및 문서 복사
7. ✅ 배포_설명서.txt 자동 생성

**결과**:
- `C:\Users\my\Desktop\HMI_DEPLOY` 폴더에 배포 패키지 생성
- 약 2-3분 소요

---

### 4️⃣ 배포 패키지 테스트

```bash
# HMI_DEPLOY 폴더에서
START_HMI_DEPLOY.bat 실행
```

**특징**:
- Frontend를 정적 파일로 서빙 (HTTP Server)
- 실제 배포 환경과 동일
- 빌드 결과 확인

**접속**:
- Frontend: http://localhost:5173 (정적 서버)
- Backend: http://localhost:8000
- PLC Simulator: 192.168.0.130:502

---

### 5️⃣ HMI PC로 배포

#### 방법 1: USB 전송
```
1. HMI_DEPLOY 폴더 전체를 USB로 복사
2. HMI PC에서 원하는 위치로 복사
3. START_HMI_DEPLOY.bat 더블클릭
```

#### 방법 2: 네트워크 복사
```
1. 네트워크 공유 폴더로 HMI_DEPLOY 복사
2. HMI PC에서 다운로드
3. START_HMI_DEPLOY.bat 더블클릭
```

#### 방법 3: 압축 파일 전송
```
1. HMI_DEPLOY 폴더를 ZIP으로 압축 (약 20-25MB)
2. USB 또는 이메일로 전송
3. HMI PC에서 압축 해제
4. START_HMI_DEPLOY.bat 더블클릭
```

---

## 📋 작업 시나리오별 가이드

### 시나리오 1: Frontend UI 수정

```bash
1. HMI_REAL/frontend/src/components/*.jsx 수정
2. START_HMI.bat 실행 (테스트)
3. 브라우저에서 실시간 확인 (자동 새로고침)
4. 만족스러우면: 배포_패키지_생성.bat 실행
5. HMI_DEPLOY로 배포
```

**예시**: 버튼 색상 변경, 레이아웃 조정, 새 컴포넌트 추가

---

### 시나리오 2: Backend API 수정

```bash
1. HMI_REAL/backend/main.py 수정
2. START_HMI.bat 실행 (테스트)
3. API 동작 확인
4. 만족스러우면: 배포_패키지_생성.bat 실행
5. HMI_DEPLOY로 배포
```

**예시**: 새 API 엔드포인트 추가, 로직 수정

---

### 시나리오 3: PLC 데이터 매핑 변경

```bash
1. HMI_REAL/backend/modbus_client.py 수정
2. HMI_REAL/simulator/plc_simulator.py 수정 (필요시)
3. START_HMI.bat 실행 (테스트)
4. 데이터 확인
5. 만족스러우면: 배포_패키지_생성.bat 실행
6. HMI_DEPLOY로 배포
```

**예시**: 새 센서 추가, 레지스터 주소 변경

---

### 시나리오 4: 의존성 추가

#### Frontend 의존성
```bash
cd HMI_REAL/frontend
npm install [패키지명]
npm run build
cd ..
배포_패키지_생성.bat 실행
```

#### Backend 의존성
```bash
cd HMI_REAL/backend
venv\Scripts\activate
pip install [패키지명]
pip freeze > requirements.txt
deactivate
cd ..
배포_패키지_생성.bat 실행
```

**주의**: 새 의존성이 추가되면 HMI_DEPLOY의 venv도 업데이트됩니다!

---

## ⚠️ 주의사항

### ❌ 하지 말아야 할 것

1. **HMI_DEPLOY에서 직접 코드 수정하지 마세요!**
   - 배포 패키지는 자동 생성되므로 덮어씌워집니다
   - 항상 HMI_REAL에서 수정

2. **수동으로 파일 복사하지 마세요!**
   - 배포_패키지_생성.bat 사용
   - 파일 누락 방지

3. **빌드 없이 배포하지 마세요!**
   - Frontend 수정 후 반드시 빌드
   - 배포_패키지_생성.bat가 자동으로 처리

### ✅ 해야 할 것

1. **Git으로 버전 관리**
   ```bash
   cd HMI_REAL
   git add .
   git commit -m "기능 추가: E/R 환기 화면 개선"
   git push
   ```

2. **테스트 후 배포**
   - 개발 환경에서 충분히 테스트
   - 배포 환경에서 최종 확인
   - HMI PC로 배포

3. **백업**
   - 중요한 변경 전 백업
   - HMI_REAL과 HMI_DEPLOY 모두 백업

---

## 🚀 빠른 참조

### 일반적인 개발 사이클
```
1. HMI_REAL에서 코드 수정
   ↓
2. START_HMI.bat로 테스트
   ↓
3. 배포_패키지_생성.bat 실행
   ↓
4. HMI_DEPLOY에서 최종 확인
   ↓
5. USB/네트워크로 HMI PC에 배포
```

### 실행 파일 정리

| 파일 | 위치 | 용도 |
|------|------|------|
| START_HMI.bat | HMI_REAL | 개발 모드 (Vite dev server) |
| START_HMI_DEPLOY.bat | HMI_DEPLOY | 배포 모드 (정적 서버) |
| 배포_패키지_생성.bat | HMI_REAL | 배포 패키지 자동 생성 |
| 자동실행.bat | HMI_DEPLOY | Windows 부팅 시 자동 실행 |

---

## 💡 팁

### Frontend 개발 시
- Vite dev server가 파일 변경을 자동 감지
- 저장만 하면 브라우저 자동 새로고침
- 빠른 반복 개발 가능

### Backend 개발 시
- 코드 수정 후 서버 재시작 필요
- Ctrl+C로 서버 종료 → START_HMI.bat 재실행

### 배포 전 체크리스트
- [ ] 개발 환경에서 정상 작동 확인
- [ ] Frontend 빌드 오류 없음
- [ ] Backend API 테스트 완료
- [ ] 배포 환경에서 최종 확인
- [ ] 문서 업데이트 (필요시)

---

## 📞 문제 해결

### Q: 배포 패키지 생성 시 오류 발생
**A**:
1. Frontend 빌드 오류 확인
2. 파일 권한 확인
3. HMI_DEPLOY 폴더가 다른 프로그램에서 사용 중인지 확인

### Q: 배포 후 화면이 안 나옴
**A**:
1. Frontend 빌드가 최신인지 확인
2. 브라우저 캐시 삭제 (Ctrl+F5)
3. dist 폴더가 제대로 복사되었는지 확인

### Q: 의존성 오류 발생
**A**:
1. requirements.txt 최신 버전 확인
2. venv 폴더 제대로 복사되었는지 확인
3. 필요시 venv 재생성

---

## 🎯 요약

### 개발은 HMI_REAL에서!
```
✅ 코드 수정
✅ 테스트
✅ Git 커밋
```

### 배포는 자동화 스크립트로!
```
✅ 배포_패키지_생성.bat 실행
✅ HMI_DEPLOY 자동 생성
✅ USB/네트워크로 전송
```

### 절대 HMI_DEPLOY에서 직접 수정하지 마세요!
```
❌ 수동 파일 복사
❌ 직접 코드 수정
❌ 빌드 건너뛰기
```

---

**이제 편하게 개발하세요!** 🚀
