# 알람 경고음 및 시각 효과 가이드

## 개요
알람 발생 시 사용자의 주의를 끌기 위해 경고음과 시각적 효과가 추가되었습니다.

## 구현된 기능

### 1. 경고음 (Audio Alert)

#### 동작 방식
- **Web Audio API**를 사용하여 브라우저에서 직접 비프음 생성
- 새로운 알람이 발생할 때 자동으로 재생
- 3번의 짧은 비프음이 연속으로 울림 (각 300ms 간격)

#### 음향 사양
- **주파수**: 880Hz (A5 음)
- **파형**: Sine wave (부드러운 사인파)
- **지속 시간**: 각 비프음당 200ms
- **음량**: 30% (귀에 부담 없는 적절한 볼륨)

#### 코드 위치
- 파일: [frontend/src/components/AlarmPanel.jsx](../frontend/src/components/AlarmPanel.jsx)
- 함수: `playAlarmSound()`

```javascript
// 경고음 재생 함수
const playAlarmSound = () => {
  if (!audioContext) return

  try {
    // 긴급 경고음 (3번의 짧은 비프음)
    for (let i = 0; i < 3; i++) {
      setTimeout(() => {
        const oscillator = audioContext.createOscillator()
        const gainNode = audioContext.createGain()

        oscillator.connect(gainNode)
        gainNode.connect(audioContext.destination)

        oscillator.frequency.value = 880 // A5 음
        oscillator.type = 'sine'

        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime)
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2)

        oscillator.start(audioContext.currentTime)
        oscillator.stop(audioContext.currentTime + 0.2)
      }, i * 300)
    }
  } catch (error) {
    console.error('경고음 재생 오류:', error)
  }
}
```

### 2. 시각 효과 (Visual Effects)

#### 2.1 알람 아이템 펄스 애니메이션
- **효과**: 미확인 알람이 부드럽게 커졌다 작아지며 깜박임
- **주기**: 2초 (경고 알람), 1.5초 (위험 알람)
- **투명도 변화**: 100% ↔ 70%
- **크기 변화**: 1.0 ↔ 1.02 배율

#### 2.2 알람 아이콘 깜박임
- **효과**: 알람 이모지(🔴🟡🟢)가 빠르게 깜박이며 크기 변화
- **주기**: 1초
- **투명도 변화**: 100% ↔ 30%
- **크기 변화**: 1.0 ↔ 1.2 배율

#### 2.3 위험(Critical) 알람 테두리 플래시
- **효과**: 위험 알람의 테두리가 빛나는 그림자 효과
- **주기**: 1.5초
- **그림자 크기**: 0px ↔ 20px
- **색상**: 빨간색 (#ef4444) 빛남

#### 2.4 알람 헤더 글로우
- **효과**: 미확인 알람이 있을 때 헤더 전체가 빛남
- **주기**: 2초
- **그림자 크기**: 5px ↔ 30px

#### 코드 위치
- 파일: [frontend/src/components/AlarmPanel.css](../frontend/src/components/AlarmPanel.css)

```css
/* 알람 깜박임 애니메이션 */
@keyframes alarm-pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.02);
  }
}

@keyframes alarm-border-flash {
  0%, 100% {
    border-color: currentColor;
    box-shadow: 0 0 0 rgba(239, 68, 68, 0);
  }
  50% {
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
  }
}

/* 미확인 알람에 깜박임 효과 적용 */
.alarm-item:not(.acknowledged) {
  animation: alarm-pulse 2s ease-in-out infinite;
}

.alarm-item.alarm-critical:not(.acknowledged) {
  animation: alarm-pulse 1.5s ease-in-out infinite, alarm-border-flash 1.5s ease-in-out infinite;
}
```

## 테스트 방법

### 1. HMI 시스템 시작

#### 방법 1: 자동 시작 스크립트
```bash
START_HMI.bat
```

#### 방법 2: 수동 시작
```bash
# 백엔드 시작
cd backend
python main.py

# 새 터미널에서 프론트엔드 시작
cd frontend
npm run dev
```

### 2. 브라우저 접속
- URL: http://localhost:5173
- 권장 브라우저: Chrome, Edge, Firefox (Web Audio API 지원)

### 3. 알람 발생 대기
- **60초 대기** - 백엔드 시작 후 60초가 지나면 알람 시나리오 시작
- 백엔드 콘솔에 "🔔 [시뮬레이터] 알람 시나리오 시작" 메시지 표시

### 4. 효과 확인

#### 경고음 확인
- [x] 알람 발생 시 "삐삐삐" 3번의 비프음이 들리는지 확인
- [x] 브라우저 음소거가 해제되어 있는지 확인
- [x] 시스템 볼륨이 적절한지 확인

#### 시각 효과 확인
- [x] 🔔 알람 메뉴 클릭 또는 자동 전환
- [x] **알람 헤더**가 빛나는 효과 확인
- [x] **알람 아이템 전체**가 펄스 효과로 깜박이는지 확인
- [x] **알람 아이콘**(🔴🟡)이 빠르게 깜박이는지 확인
- [x] **위험 알람**(🔴)의 테두리가 빨간 빛을 내는지 확인

#### 알람 확인 후 효과 중지
- [x] "확인" 버튼 클릭
- [x] 깜박임 효과가 멈추고 투명도가 낮아지는지 확인
- [x] 새로운 미확인 알람만 계속 깜박이는지 확인

### 5. 반복 테스트
- 알람은 **70초 주기**로 반복됩니다
  - 0~59초: 정상 상태
  - 60~69초: 알람 발생 (경고음 + 시각 효과)
  - 70초~: 정상 복귀

## 주의사항

### 경고음 관련
1. **브라우저 자동재생 정책**
   - Chrome/Edge: 사용자가 페이지와 상호작용한 후에만 소리 재생 가능
   - 해결: HMI 접속 후 화면을 한 번 클릭하세요

2. **음소거 확인**
   - 브라우저 탭이 음소거되지 않았는지 확인
   - 시스템 볼륨이 0이 아닌지 확인

3. **Web Audio API 지원**
   - 모든 최신 브라우저에서 지원
   - IE는 지원하지 않음 (Edge 사용 권장)

### 시각 효과 관련
1. **성능**
   - CSS 애니메이션 사용으로 성능 영향 최소화
   - GPU 가속 활성화됨

2. **알람 확인 후**
   - 확인된 알람은 투명도가 낮아지고 애니메이션 중지
   - 새로운 미확인 알람만 깜박임 효과 표시

## 커스터마이징

### 경고음 변경
```javascript
// AlarmPanel.jsx의 playAlarmSound() 함수에서 수정 가능

oscillator.frequency.value = 880  // 주파수 변경 (높을수록 높은 음)
gainNode.gain.setValueAtTime(0.3, ...)  // 볼륨 변경 (0.0 ~ 1.0)
for (let i = 0; i < 3; i++)  // 비프음 횟수 변경
setTimeout(..., i * 300)  // 비프음 간격 변경 (ms)
```

### 시각 효과 변경
```css
/* AlarmPanel.css에서 수정 가능 */

/* 펄스 속도 변경 */
.alarm-item:not(.acknowledged) {
  animation: alarm-pulse 2s ease-in-out infinite;  /* 2s를 원하는 시간으로 변경 */
}

/* 깜박임 강도 변경 */
@keyframes alarm-pulse {
  50% {
    opacity: 0.7;  /* 0.0 ~ 1.0 사이 값으로 변경 */
    transform: scale(1.02);  /* 크기 변화 정도 변경 */
  }
}

/* 그림자 크기 변경 */
@keyframes alarm-border-flash {
  50% {
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);  /* 20px를 원하는 크기로 변경 */
  }
}
```

## 문제 해결

### 경고음이 들리지 않아요
1. 브라우저 탭을 클릭하여 사용자 상호작용 제공
2. 브라우저 콘솔(F12)에서 오류 메시지 확인
3. 시스템 볼륨 및 브라우저 음소거 상태 확인
4. 다른 브라우저(Chrome, Edge)에서 시도

### 시각 효과가 보이지 않아요
1. 브라우저 캐시 삭제 후 새로고침 (Ctrl+Shift+R)
2. 브라우저 개발자 도구(F12)에서 CSS 로딩 확인
3. 알람이 실제로 발생했는지 확인 (60초 대기)
4. "확인" 버튼을 누르지 않았는지 확인

### 알람이 너무 시끄러워요
```javascript
// AlarmPanel.jsx 수정
gainNode.gain.setValueAtTime(0.1, audioContext.currentTime)  // 볼륨 낮춤 (0.3 → 0.1)
```

### 깜박임이 너무 심해요
```css
/* AlarmPanel.css 수정 */
.alarm-item:not(.acknowledged) {
  animation: alarm-pulse 3s ease-in-out infinite;  /* 느리게 (2s → 3s) */
}

@keyframes alarm-pulse {
  50% {
    opacity: 0.85;  /* 덜 투명하게 (0.7 → 0.85) */
  }
}
```

## 관련 파일

- [frontend/src/components/AlarmPanel.jsx](../frontend/src/components/AlarmPanel.jsx) - 경고음 로직
- [frontend/src/components/AlarmPanel.css](../frontend/src/components/AlarmPanel.css) - 시각 효과 애니메이션
- [backend/modbus_client.py](../backend/modbus_client.py) - 알람 시나리오 생성
- [backend/alarm_manager.py](../backend/alarm_manager.py) - 알람 감지 및 관리

## 관련 문서

- [알람_시스템_테스트_결과.md](알람_시스템_테스트_결과.md) - 알람 시스템 검증 결과
- [알람_시스템_사용_가이드.md](알람_시스템_사용_가이드.md) - 알람 시스템 전체 가이드

---

**작성일**: 2025-11-12
**버전**: 1.0
**작성자**: Claude Code
