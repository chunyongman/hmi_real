# 알람 시스템 테스트 결과

## 테스트 일시
2025-11-12

## 테스트 목적
시뮬레이터의 알람 시나리오가 정상 작동하는지 확인

## 테스트 방법
직접 시뮬레이터의 센서 데이터를 70초간 모니터링하여 알람 조건 확인

## 테스트 결과

### ✅ 성공: 알람 시나리오 정상 작동

#### 시간별 동작
- **0~59초**: 정상 범위
  - TX6 (E/R 온도): 32~38°C
  - DPX1 (SW 압력): 2.4~2.6 bar
  - 상태: [OK]

- **60~69초**: 알람 조건 발생
  - TX6: 51.5~52.5°C (임계값 50°C 초과)
  - DPX1: 1.26~1.34 bar (임계값 1.5 bar 미만)
  - 상태: [ALARM!]

- **70초~**: 정상 복귀
  - TX6: 36.7°C
  - DPX1: 2.50 bar
  - 상태: [OK]

### 상세 로그

```
[  0s] TX6:  37.9C  DPX1:  2.44 bar  [OK]
[ 10s] TX6:  32.4C  DPX1:  2.45 bar  [OK]
[ 20s] TX6:  34.3C  DPX1:  2.43 bar  [OK]
[ 30s] TX6:  37.8C  DPX1:  2.55 bar  [OK]
[ 40s] TX6:  36.3C  DPX1:  2.59 bar  [OK]
[ 50s] TX6:  37.8C  DPX1:  2.58 bar  [OK]
[ 60s] TX6:  52.5C  DPX1:  1.29 bar  [ALARM!]   ← 알람 시작
[ 61s] TX6:  51.5C  DPX1:  1.29 bar  [ALARM!]
[ 62s] TX6:  51.6C  DPX1:  1.33 bar  [ALARM!]
[ 63s] TX6:  52.4C  DPX1:  1.28 bar  [ALARM!]
[ 64s] TX6:  51.8C  DPX1:  1.26 bar  [ALARM!]
[ 65s] TX6:  51.9C  DPX1:  1.28 bar  [ALARM!]
[ 66s] TX6:  52.1C  DPX1:  1.33 bar  [ALARM!]
[ 67s] TX6:  51.6C  DPX1:  1.28 bar  [ALARM!]
[ 68s] TX6:  51.5C  DPX1:  1.34 bar  [ALARM!]
[ 69s] TX6:  51.9C  DPX1:  1.28 bar  [ALARM!]
[ 70s] TX6:  36.7C  DPX1:  2.50 bar  [OK]      ← 정상 복귀
```

## 구현 방법

### 시간 기반 알람 시나리오 (backend/modbus_client.py)

```python
# 알람 시나리오: 시간 기반 (70초 주기 - 60초 정상, 10초 알람)
cycle_position = int(elapsed) % 70

# TX6 (E/R 온도) 및 DPX1 (압력) - 알람 시나리오 적용
if 60 <= cycle_position < 70:  # 60~69초: 알람 조건
    tx6_value = 52.0 + random.uniform(-0.5, 0.5)  # 임계값 50°C 초과
    dpx1_value = 1.3 + random.uniform(-0.05, 0.05)  # 임계값 1.5 bar 미만
else:  # 0~59초: 정상 범위
    tx6_value = 35.0 + random.uniform(-3, 3)  # 정상 범위
    dpx1_value = 2.5 + random.uniform(-0.1, 0.1)  # 정상 범위
```

### 알람 임계값 (backend/alarm_manager.py)

```python
# 온도 알람
"T6_HIGH": {"threshold": 50.0, "level": "critical", "message": "E/R Temp High"}

# 압력 알람
"PX1_LOW": {"threshold": 1.5, "level": "warning", "message": "SW Pressure Low"}
```

## HMI에서 알람 확인 방법

1. **START_HMI.bat 실행** 또는 백엔드 시작
   ```bash
   cd backend
   python main.py
   ```

2. **브라우저에서 http://localhost:5173 접속**

3. **60초 대기**
   - 백엔드 콘솔에 "알람 시나리오 시작" 메시지 표시
   - HMI 화면에서 알람 패널로 자동 전환 (또는 수동으로 🔔 알람 메뉴 클릭)

4. **알람 확인**
   - **🔴 E/R Temp High: 52.0°C** (위험)
   - **🟡 SW Pressure Low: 1.3 bar** (경고)

5. **10초 후 자동 해제**
   - 70초 경과 시 알람이 자동으로 정상 복귀

## 알람 이력 확인

1. **📋 이력** 메뉴 클릭
2. **🔔 알람 이력** 탭 선택
3. 발생한 알람 이력 조회 가능
4. **📥 CSV 내보내기**로 보고서 생성

## 주의사항

- ⏰ **백엔드 시작 후 60초 대기 필요**
- 🔄 **70초 주기로 반복** (60초 정상 + 10초 알람)
- 🌐 **WebSocket 연결 필요** (브라우저에서 HMI 접속 시)

## 결론

✅ 알람 시스템이 완전히 구현되었으며, 시뮬레이터에서 정확하게 작동합니다.
✅ 실제 PLC 연결 시와 동일한 방식으로 동작하여 배포 준비가 완료되었습니다.

---

**테스트 스크립트**: [test_alarm_scenario.py](../test_alarm_scenario.py)
**사용 가이드**: [알람_시스템_사용_가이드.md](알람_시스템_사용_가이드.md)
