# 🧪 ESS HMI 시스템 테스트 가이드

이 문서는 HMI_WEB_NEW 시스템을 테스트하는 방법을 설명합니다.

## 📋 테스트 체크리스트

### 1단계: 시스템 시작 테스트 ✅

#### 1.1 필수 파일 확인
- [ ] `backend/venv` 폴더 존재
- [ ] `frontend/node_modules` 폴더 존재
- [ ] `simulator/plc_simulator.py` 파일 존재
- [ ] `START_HMI.bat` 파일 존재

#### 1.2 시스템 시작
```batch
START_HMI.bat
```

**예상 결과:**
- 3개의 CMD 창이 열림 (시뮬레이터, 백엔드, 프론트엔드)
- 10초 후 브라우저 자동 실행

#### 1.3 각 서비스 로그 확인

**시뮬레이터 창:**
```
✅ PLC 시뮬레이터 시작
📡 Modbus TCP 서버: 192.168.0.130:502
🔧 Slave ID: 3
```

**백엔드 창:**
```
✅ PLC 연결 성공: 192.168.0.130:502
📡 실시간 데이터 브로드캐스트 시작 (1초 간격)
INFO:     Application startup complete.
```

**프론트엔드 창:**
```
  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
  ➜  press h + enter to show help
```

---

### 2단계: 프론트엔드 연결 테스트 ✅

#### 2.1 브라우저 접속
- URL: `http://localhost:5173`
- **예상 결과**: HMI 화면 표시

#### 2.2 WebSocket 연결 확인
1. 브라우저에서 F12 눌러 개발자 도구 열기
2. Console 탭 확인

**예상 로그:**
```
WebSocket 연결 시도: ws://localhost:8000/ws
✅ WebSocket 연결 성공
```

#### 2.3 상태 표시 확인
- [ ] 헤더 오른쪽에 "PLC 연결됨" 표시 (녹색)
- [ ] 센서 데이터가 실시간으로 변경됨

---

### 3단계: 센서 데이터 확인 ✅

#### 3.1 대시보드 화면 확인
- [ ] TX1~TX7 온도 센서 값이 표시됨 (약 20~30°C)
- [ ] DPX1 압력 센서 값 표시 (약 1~3 kg/cm²)
- [ ] DPX2 압력 센서 값 표시 (약 50~150 Pa)
- [ ] PU1 M/E 부하 표시 (약 40~60%)

#### 3.2 데이터 실시간 업데이트 확인
- [ ] 센서 값이 1초마다 자동으로 변경됨
- [ ] 값이 현실적인 범위 내에서 변동

---

### 4단계: 장비 제어 테스트 ✅

#### 4.1 펌프 제어 테스트

1. **"⚙️ 펌프 제어" 탭 클릭**

2. **SWP1 시작 테스트:**
   - [ ] SWP1 카드의 "▶️ 시작" 버튼 클릭
   - [ ] 브라우저 콘솔 확인:
     ```
     🔧 장비 명령 전송 시도: equipment=SWP1, command=start
     ✅ SWP1 start 명령 성공
     ```
   - [ ] 시뮬레이터 창 확인:
     ```
     ✅ 제어 명령 수신: START SWP1
     ```
   - [ ] SWP1 상태가 "🟢 운전중"으로 변경
   - [ ] 주파수 및 전력 값이 증가

3. **SWP1 정지 테스트:**
   - [ ] "⏸️ 정지" 버튼 클릭
   - [ ] SWP1 상태가 "⚪ 정지"로 변경
   - [ ] 주파수 및 전력 값이 감소

4. **다른 펌프 테스트 (SWP2, SWP3, FWP1-3):**
   - [ ] 각 펌프에 대해 START/STOP 테스트 반복

#### 4.2 팬 제어 테스트

1. **"🌀 팬 제어" 탭 클릭**

2. **FAN1 정방향 테스트:**
   - [ ] FAN1 카드의 "▶️ 정방향" 버튼 클릭
   - [ ] 브라우저 콘솔 확인:
     ```
     🔧 장비 명령 전송 시도: equipment=FAN1, command=start_fwd
     ✅ FAN1 정방향 시작 명령 성공
     ```
   - [ ] FAN1 상태가 "🟢 정방향"으로 변경

3. **FAN1 역방향 테스트:**
   - [ ] 먼저 FAN1 정지
   - [ ] "◀️ 역방향" 버튼 클릭
   - [ ] FAN1 상태가 "🟡 역방향"으로 변경

4. **다른 팬 테스트 (FAN2-4):**
   - [ ] 각 팬에 대해 FWD/BWD/STOP 테스트 반복

---

### 5단계: 화면 네비게이션 테스트 ✅

#### 5.1 모든 탭 확인
- [ ] 📊 대시보드: 전체 시스템 개요 표시
- [ ] 🔧 배관 계통도: SVG 다이어그램 표시
- [ ] ⚙️ 펌프 제어: 펌프 제어 패널 표시
- [ ] 🌀 팬 제어: 팬 제어 패널 표시
- [ ] 🎛️ 고급 제어: 고급 제어 옵션 표시
- [ ] ⚙️ 설정: 설정 화면 표시
- [ ] 📈 트렌드: 차트 표시
- [ ] 📋 이력: 히스토리 표시
- [ ] 🔔 알람: 알람 패널 표시

---

### 6단계: VFD 데이터 확인 ✅

#### 6.1 펌프 제어 화면에서 펌프 선택
1. 운전 중인 펌프 카드 클릭
2. 하단 "상세 정보" 패널 확인

**확인 항목:**
- [ ] 운전 상태 표시
- [ ] ESS 모드 상태
- [ ] 현재 주파수 (Hz)
- [ ] 현재 전력 (kW)
- [ ] 평균 전력 (kW)
- [ ] 절감 전력량 (kWh)
- [ ] 절감률 (%)
- [ ] 운전 시간 (h)

---

### 7단계: 트렌드 차트 테스트 ✅

#### 7.1 트렌드 화면 확인
1. "📈 트렌드" 탭 클릭
2. 차트 표시 확인

**확인 항목:**
- [ ] 온도 트렌드 차트 표시
- [ ] 압력 트렌드 차트 표시
- [ ] 데이터가 실시간으로 추가됨
- [ ] 최근 60초 데이터 표시

---

### 8단계: API 엔드포인트 테스트 ✅

#### 8.1 REST API 테스트

브라우저에서 다음 URL 접속:

**1. API 정보:**
```
http://localhost:8000/api
```
**예상 결과:**
```json
{
  "service": "ESS HMI Backend",
  "system": "Engine Room Ventilation System",
  "version": "2.0.0",
  "status": "running",
  "plc_connected": true,
  "equipment": {
    "pumps": 6,
    "fans": 4
  }
}
```

**2. 센서 데이터:**
```
http://localhost:8000/api/sensors
```

**3. 모든 장비 데이터:**
```
http://localhost:8000/api/equipment
```

**4. 펌프 데이터만:**
```
http://localhost:8000/api/pumps
```

**5. 팬 데이터만:**
```
http://localhost:8000/api/fans
```

**6. API 문서:**
```
http://localhost:8000/docs
```

---

### 9단계: 성능 테스트 ✅

#### 9.1 메모리 사용량 확인
- [ ] 백엔드 메모리 사용량 < 200MB
- [ ] 프론트엔드 로딩 시간 < 3초
- [ ] WebSocket 메시지 지연 < 100ms

#### 9.2 동시 제어 테스트
1. 여러 펌프/팬을 빠르게 연속으로 제어
2. 시스템이 정상적으로 반응하는지 확인

---

### 10단계: 오류 처리 테스트 ✅

#### 10.1 시뮬레이터 중단 테스트
1. 시뮬레이터 창 닫기
2. HMI 화면 확인
   - [ ] "PLC 연결 안됨" 표시
   - [ ] 센서 데이터가 0으로 표시되거나 마지막 값 유지
3. 시뮬레이터 재시작
   - [ ] 자동으로 재연결
   - [ ] 데이터 정상 표시

#### 10.2 백엔드 중단 테스트
1. 백엔드 창 닫기
2. 브라우저 콘솔 확인
   - [ ] WebSocket 연결 오류 표시
   - [ ] 5초 후 자동 재연결 시도
3. 백엔드 재시작
   - [ ] 자동으로 재연결

---

## 🐛 문제 해결

### 문제 1: "PLC 연결 안됨" 표시
**해결:**
1. 시뮬레이터가 실행 중인지 확인
2. 포트 502가 사용 가능한지 확인
3. 관리자 권한으로 실행했는지 확인

### 문제 2: 프론트엔드 로딩 안됨
**해결:**
1. `frontend/node_modules` 폴더 확인
2. 없으면: `cd frontend && npm install`
3. 프론트엔드 창에서 에러 메시지 확인

### 문제 3: WebSocket 연결 실패
**해결:**
1. 백엔드가 포트 8000에서 실행 중인지 확인
2. 방화벽 설정 확인
3. 브라우저 콘솔에서 정확한 오류 메시지 확인

### 문제 4: 장비 명령이 작동 안함
**해결:**
1. 브라우저 콘솔에서 HTTP 응답 확인
2. 백엔드 로그 확인
3. 시뮬레이터 로그 확인

---

## ✅ 테스트 완료 기준

모든 체크박스를 체크할 수 있으면 시스템이 정상 작동합니다:

- [ ] 시스템 시작 성공 (3개 서비스)
- [ ] 브라우저에서 HMI 접속 성공
- [ ] WebSocket 연결 성공
- [ ] 센서 데이터 실시간 업데이트
- [ ] 펌프 6개 모두 제어 가능 (START/STOP)
- [ ] 팬 4개 모두 제어 가능 (FWD/BWD/STOP)
- [ ] VFD 데이터 표시
- [ ] 모든 탭 정상 작동
- [ ] API 엔드포인트 정상 응답
- [ ] 오류 상황에서 적절한 메시지 표시

---

## 📊 테스트 결과 기록

| 테스트 항목 | 결과 | 비고 |
|------------|------|------|
| 시스템 시작 | ☐ Pass ☐ Fail | |
| 프론트엔드 연결 | ☐ Pass ☐ Fail | |
| 센서 데이터 | ☐ Pass ☐ Fail | |
| 펌프 제어 | ☐ Pass ☐ Fail | |
| 팬 제어 | ☐ Pass ☐ Fail | |
| VFD 데이터 | ☐ Pass ☐ Fail | |
| 트렌드 차트 | ☐ Pass ☐ Fail | |
| API 테스트 | ☐ Pass ☐ Fail | |
| 오류 처리 | ☐ Pass ☐ Fail | |

---

**테스트 날짜:** _______________
**테스터:** _______________
**시스템 버전:** 2.0.0
**특이사항:** _______________
